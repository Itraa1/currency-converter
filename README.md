# Currency-converter
Бэкенд-приложение для конвертации валют, выступающее в качестве прослойки между клиентским приложением и сторонними API предоставляющими информацию о курсах валют.

---

## Основные возможности
+ Получение списка поддерживаемых валют
+ Конвертация валют с использованием актуальных курсов
+ Управление настройками пользователя (базовая валюта, избранные валюты)
+ Интеллектуальное кэширование для оптимизации производительности
+ Автоматическая авторизация пользователей

## Технологический стек
+ Node.js (LTS версия, указана в .nvmrc)
+ TypeScript
+ Express.js - фреймворк для создания REST API
+ Supabase - облачная база данных
+ Axios - HTTP клиент для работы со сторонними API

## Предварительные требования
+ Node.js (версия указана в .nvmrc)
+ npm
+ Аккаунт в Supabase
+ Доступ к API ExchangeRate-API

## Настройте переменные окружения:

+ Скопируйте файл .env.example в .env
+ Заполните необходимые переменные:
```
#SUPABASE 
SUPABASE_URL = supabase_url
SUPABASE_KEY = supabase_key 
#exchangerate-api
EXCHANGERATE_KEY = exchangerate-api_key
```
## Настройте БД supabse

Необходимо создать 3 таблицы:

<details>
<summary>1.users</summary>

```
create table public.users (
  user_id uuid not null default gen_random_uuid (),
  base_currency character(3) not null default 'USD'::bpchar,
  favorites text[] null default '{}'::text[],
  created_at timestamp with time zone not null default (now() AT TIME ZONE 'utc'::text),
  updated_at timestamp with time zone not null default (now() AT TIME ZONE 'utc'::text),
  constraint users_pkey primary key (user_id)
) TABLESPACE pg_default;
```
</details>

<details>
<summary>2.currencies</summary>

```
create table public.currencies (
  id bigint generated by default as identity not null,
  code character varying not null,
  created_at timestamp with time zone not null default now(),
  constraint currencies_pkey primary key (id),
  constraint currencies_code_key unique (code)
) TABLESPACE pg_default;
```
</details>

<details>
<summary>3.cache_rates_query</summary>

```
create table public.cache_rates_query (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default (now() AT TIME ZONE 'utc'::text),
  request text not null,
  response text not null,
  expires_at timestamp with time zone not null,
  constraint cache_rates_query_pkey primary key (id),
  constraint cache_rates_query_request_key unique (request)
) TABLESPACE pg_default;
```
</details>

## API Endpoints

##### 1. GET /api/currencies

Возвращает список поддерживаемых валют в формате ISO4217.
Кэширование: Результаты кэшируются на 1 час
Пример ответа:
```
{
  "currencies": ["USD", "EUR", "GBP", "JPY", "CAD", "AUD", "CHF", "CNY"]
}
```

##### 2. GET /api/rates

Возвращает курсы валют для указанной базовой валюты.
Параметры:
+ base (опционально) - базовая валюта (например, USD). Если не указана, используется валюта из настроек пользователя
+ targets - массив валют через запятую (например, EUR,GBP,JPY)

Пример запроса:
```
GET /api/rates?base=USD&targets=EUR,GBP,JPY
```
Пример ответа:
```
{
    "EUR": 0.843,
    "GBP": 0.7301,
    "JPY": 154.9866
}
```

Кэширование:
Данные курсов кэшируются на 24 часа в базе данных.
Ответы кэшируются в памяти на 5 минут для одинаковых запросов от одного пользователя.

##### 3. GET /api/user
Возвращает настройки текущего пользователя.
Аутентификация: Автоматически по куке user_id

Пример ответа:
```
{
    "user_id": "e2221a4d-1920-42fe-88b0-70d2787eced4",
    "base_currency": "BYN",
    "favorites": [
        "USD",
        "EUR"
    ],
    "created_at": "2026-02-01T14:19:06.821407+00:00",
    "updated_at": "2026-02-01T14:31:33.65+00:00"
}
```

##### 4. POST /api/user
Обновляет настройки пользователя.

Тело запроса:
```
{
    "base_currency": "BYN",
    "favorites": [ "USD", "EUR"]
} 
```

Пример ответа:
```
{
    "user_id": "e2221a4d-1920-42fe-88b0-70d2787eced4",
    "base_currency": "BYN",
    "favorites": [
        "USD",
        "EUR"
    ],
    "created_at": "2026-02-01T14:19:06.821407+00:00",
    "updated_at": "2026-02-02T09:34:03.368+00:00"
}
```

## Авторизация
При первом обращении к любому эндпоинту система автоматически:
+ Генерирует уникальный user_id
+ Устанавливает httpOnly куку user_id
+ Создает запись пользователя в базе данных с + базовой валютой USD
+ Возвращает куку в ответе

## Поддерживаемые валюты
<details>
<summary>165 поддерживаемых валют</summary>

Currency Code | Currency Name | Country
:-------------|:-------------:|--------:
AED|	UAE Dirham|	United Arab Emirates
AFN|	Afghan Afghani|	Afghanistan
ALL|	Albanian Lek|	Albania
AMD|	Armenian Dram|	Armenia
ANG|	Netherlands Antillian Guilder|	Netherlands Antilles
AOA|	Angolan Kwanza|	Angola
ARS|	Argentine Peso|	Argentina
AUD|	Australian Dollar|	Australia
AWG|	Aruban Florin|	Aruba
AZN|	Azerbaijani Manat|	Azerbaijan
BAM|	Bosnia and Herzegovina Mark|	Bosnia and Herzegovina
BBD|	Barbados Dollar|	Barbados
BDT|	Bangladeshi Taka|	Bangladesh
BGN|	Bulgarian Lev|	Bulgaria
BHD|	Bahraini Dinar|	Bahrain
BIF|	Burundian Franc|	Burundi
BMD|	Bermudian Dollar|	Bermuda
BND|	Brunei Dollar|	Brunei
BOB|	Bolivian Boliviano|	Bolivia
BRL|	Brazilian Real|	Brazil
BSD|	Bahamian Dollar|	Bahamas
BTN|	Bhutanese Ngultrum|	Bhutan
BWP|	Botswana Pula|	Botswana
BYN|	Belarusian Ruble|	Belarus
BZD|	Belize Dollar|	Belize
CAD|	Canadian Dollar|	Canada
CDF|	Congolese Franc|	Democratic Republic of the Congo
CHF|	Swiss Franc|	Switzerland
CLF|	Chilean Unidad de Fomento|	Chile
CLP|	Chilean Peso|	Chile
CNH|	Offshore Chinese Renminbi|	China
CNY|	Chinese Renminbi|	China
COP|	Colombian Peso|	Colombia
CRC|	Costa Rican Colon|	Costa Rica
CUP|	Cuban Peso|	Cuba
CVE|	Cape Verdean Escudo|	Cape Verde
CZK|	Czech Koruna|	Czech Republic
DJF|	Djiboutian Franc|	Djibouti
DKK|	Danish Krone|	Denmark
DOP|	Dominican Peso|	Dominican Republic
DZD|	Algerian Dinar|	Algeria
EGP|	Egyptian Pound|	Egypt
ERN|	Eritrean Nakfa|	Eritrea
ETB|	Ethiopian Birr|	Ethiopia
EUR|	Euro|	European Union
FJD|	Fiji Dollar|	Fiji
FKP|	Falkland Islands Pound|	Falkland Islands
FOK|	Faroese Króna|	Faroe Islands
GBP|	Pound Sterling|	United Kingdom
GEL|	Georgian Lari|	Georgia
GGP|	Guernsey Pound|	Guernsey
GHS|	Ghanaian Cedi|	Ghana
GIP|	Gibraltar Pound|	Gibraltar
GMD|	Gambian Dalasi|	The Gambia
GNF|	Guinean Franc|	Guinea
GTQ|	Guatemalan Quetzal|	Guatemala
GYD|	Guyanese Dollar|	Guyana
HKD|	Hong Kong Dollar|	Hong Kong
HNL|	Honduran Lempira|	Honduras
HRK|	Croatian Kuna|	Croatia
HTG|	Haitian Gourde|	Haiti
HUF|	Hungarian Forint|	Hungary
IDR|	Indonesian Rupiah|	Indonesia
ILS|	Israeli New Shekel|	Israel
IMP|	Manx Pound|	Isle of Man
INR|	Indian Rupee|	India
IQD|	Iraqi Dinar|	Iraq
IRR|	Iranian Rial|	Iran
ISK|	Icelandic Króna|	Iceland
JEP|	Jersey Pound|	Jersey
JMD|	Jamaican Dollar|	Jamaica
JOD|	Jordanian Dinar|	Jordan
JPY|	Japanese Yen|	Japan
KES|	Kenyan Shilling|	Kenya
KGS|	Kyrgyzstani Som|	Kyrgyzstan
KHR|	Cambodian Riel|	Cambodia
KID|	Kiribati Dollar|	Kiribati
KMF|	Comorian Franc|	Comoros
KRW|	South Korean Won|	South Korea
KWD|	Kuwaiti Dinar|	Kuwait
KYD|	Cayman Islands Dollar|	Cayman Islands
KZT|	Kazakhstani Tenge|	Kazakhstan
LAK|	Lao Kip|	Laos
LBP|	Lebanese Pound|	Lebanon
LKR|	Sri Lanka Rupee|	Sri Lanka
LRD|	Liberian Dollar|	Liberia
LSL|	Lesotho Loti|	Lesotho
LYD|	Libyan Dinar|	Libya
MAD|	Moroccan Dirham|	Morocco
MDL|	Moldovan Leu|	Moldova
MGA|	Malagasy Ariary|	Madagascar
MKD|	Macedonian Denar|	North Macedonia
MMK|	Burmese Kyat|	Myanmar
MNT|	Mongolian Tögrög|	Mongolia
MOP|	Macanese Pataca|	Macau
MRU|	Mauritanian Ouguiya|	Mauritania
MUR|	Mauritian Rupee|	Mauritius
MVR|	Maldivian Rufiyaa|	Maldives
MWK|	Malawian Kwacha|	Malawi
MXN|	Mexican Peso|	Mexico
MYR|	Malaysian Ringgit|	Malaysia
MZN|	Mozambican Metical|	Mozambique
NAD|	Namibian Dollar|	Namibia
NGN|	Nigerian Naira|	Nigeria
NIO|	Nicaraguan Córdoba|	Nicaragua
NOK|	Norwegian Krone|	Norway
NPR|	Nepalese Rupee|	Nepal
NZD|	New Zealand Dollar|	New Zealand
OMR|	Omani Rial|	Oman
PAB|	Panamanian Balboa|	Panama
PEN|	Peruvian Sol|	Peru
PGK|	Papua New Guinean Kina|	Papua New Guinea
PHP|	Philippine Peso|	Philippines
PKR|	Pakistani Rupee|	Pakistan
PLN|	Polish Złoty|	Poland
PYG|	Paraguayan Guaraní|	Paraguay
QAR|	Qatari Riyal|	Qatar
RON|	Romanian Leu|	Romania
RSD|	Serbian Dinar|	Serbia
RUB|	Russian Ruble|	Russia
RWF|	Rwandan Franc|	Rwanda
SAR|	Saudi Riyal|	Saudi Arabia
SBD|	Solomon Islands Dollar|	Solomon Islands
SCR|	Seychellois Rupee|	Seychelles
SDG|	Sudanese Pound|	Sudan
SEK|	Swedish Krona|	Sweden
SGD|	Singapore Dollar|	Singapore
SHP|	Saint Helena Pound|	Saint Helena
SLE|	Sierra Leonean Leone|	Sierra Leone
SOS|	Somali Shilling|	Somalia
SRD|	Surinamese Dollar|	Suriname
SSP|	South Sudanese Pound|	South Sudan
STN|	São Tomé and Príncipe Dobra|	São Tomé and Príncipe
SYP|	Syrian Pound|	Syria
SZL|	Eswatini Lilangeni|	Eswatini
THB|	Thai Baht|	Thailand
TJS|	Tajikistani Somoni|	Tajikistan
TMT|	Turkmenistan Manat|	Turkmenistan
TND|	Tunisian Dinar|	Tunisia
TOP|	Tongan Paʻanga|	Tonga
TRY|	Turkish Lira|	Turkey
TTD|	Trinidad and Tobago Dollar|	Trinidad and Tobago
TVD|	Tuvaluan Dollar|	Tuvalu
TWD|	New Taiwan Dollar|	Taiwan
TZS|	Tanzanian Shilling|	Tanzania
UAH|	Ukrainian Hryvnia|	Ukraine
UGX|	Ugandan Shilling|	Uganda
USD|	United States Dollar|	United States
UYU|	Uruguayan Peso|	Uruguay
UZS|	Uzbekistani So'm|	Uzbekistan
VES|	Venezuelan Bolívar Soberano|	Venezuela
VND|	Vietnamese Đồng|	Vietnam
VUV|	Vanuatu Vatu|	Vanuatu
WST|	Samoan Tālā|	Samoa
XAF|	Central African CFA Franc|	CEMAC
XCD|	East Caribbean Dollar|	Organisation of Eastern Caribbean States
XDR|	Special Drawing Rights|	International Monetary Fund
XOF|	West African CFA franc|	CFA
XPF|	CFP Franc|	Collectivités d'Outre-Mer
YER|	Yemeni Rial|	Yemen
ZAR|	South African Rand|	South Africa
ZMW|	Zambian Kwacha|	Zambia
ZWL|	Zimbabwean Dollar|	Zimbabwe
</details>

